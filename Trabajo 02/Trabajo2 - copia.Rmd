---
title: |
  \includegraphics[width=25cm]{EscudoUN.png}  
  \thispagestyle{empty} 
  \vspace*{2.0cm} 
  \textbf{\huge Localización de ocurrencia de incendios en el 2017 de USA \\Estadística espacial}  
  \vspace{5.07cm}
author: |
 |  \Large \textbf{Daniela Arbeláez Montoya}
 |  \Large \textbf{Jefferson Gamboa Betancur}
 |  \Large \textbf{Jean Paul Piedrahita García}
 |  \vspace{5cm}
date: |
  | \small Universidad Nacional de Colombia
  | Ciencias, Escuela de Estadística
  | Medellín, Colombia
  | 2021
documentclass: article
geometry: 
  - top=2cm
  - left=1.8cm
  - right=2cm
  - bottom=2.54cm
fontsize: 12pt
pagestyle: empty
papersize: a4
linestretch: 1.5
linkcolor: blue
links-as-notes: true
lang: "es"
header-includes:
- \usepackage[utf8]{inputenc}
- \setlength{\parindent}{0pt}
- \usepackage{graphicx}
- \pagenumbering{gobble}
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
- \usepackage{hyperref}
output: 
    pdf_document: 
      toc: yes
      number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  cache = TRUE,
  message = FALSE,
  error = FALSE,
  warning = FALSE,
  tidy = TRUE,
  tidy.opts=list(width.cutoff = 55),
  prompt = TRUE
  )
options(kableExtra.latex.load_packages = FALSE)
require(kableExtra)
```

# Introducción

California es uno de los lugares que tiene las temporadas de incendios forestales más mortíferas y destructivas. El conjunto de datos contiene la lista de incendios forestales ocurridos en California entre 2013 y 2020. El conjunto de datos contiene la ubicación donde ocurrieron los incendios forestales, incluido el nombre del condado, los valores de latitud y longitud y también detalles sobre cuándo comenzó el incendio forestal.

Estos datos ayudan a generar información sobre qué lugares de California están bajo amenaza de incendio, a qué hora suelen ocurrir los incendios forestales y qué tan frecuentes y devastadores son.

La base de datos con la que se va realizar el análisis de patrones puntuales fue descargada de ![kaggle]("https://www.kaggle.com/ananthu017/california-wildfire-incidents-20132020").

Los paquetes a utilizar son los siguientes: 

```{r}
library(spatstat)
library(sf)
library(raster)
library(rgdal)
library(tidyverse)
library(maps)
```


# Análisis descriptivo

Para leer el archivo se utiliza la función *"read_csv"* de la librería *"tidyverse"* asignando el nombre de *"firesCA"* y luego la estructura de la base de datos con la función *"glimpse".* que consta de 1636 filas y 40 columnas con la descripción de cada variable.

```{r}
firesCA <- read_csv(file = "https://raw.githubusercontent.com/JeffGB94/Estadistica_Espacial/main/Trabajo%2002/Base/California_Fire_Incidents.csv")

glimpse(firesCA)
```

Luego se seleccionan las variables de interés, donde *AcresBurned* son los acres quemados en un año determinado, *Active* indica si el incendio sigue activo (*TRUE*) o no (*FALSE*), *ArchiveYear* es el año donde se tomó la localización del incendio, *Name* es el nombre de incendio, *Counties* son los condados donde se inició el incendio, *Status* muestra si el incendio esta finalizado o inactivo, y por último *Latitude* y *Longitude* indica la latitud y a latitud respectivamente. 

```{r}
firesCA <- firesCA %>% select(AcresBurned, Active, ArchiveYear, Name, 
                              Counties, Status, Latitude, Longitude)
```

En base a todas estas observaciones, ¿cuántos incendios ocurrieron durante el periodo de observación? 

```{r}
table(firesCA$ArchiveYear)
```
El año donde se presentaron más incendios fue en el 2017 y en el que menos se presentaron fue en el 2014, para nuestro estudio usaremos el año 2017 de esta manera.

```{r}
# Seleccionando el año 2017
firesCA2017 <- firesCA %>% filter(ArchiveYear == 2017, Longitude != 0, Latitude != 0)
```

Al seleccionar el año 2017, se busca si hay localizaciones duplicadas, y posteriormente se encontraron 6 observaciones que se retiraron de la base de datos.

```{r}
Nduplicado<- sum(duplicated(firesCA2017 %>% select(Longitude, Latitude)))
firesCA2017 <- firesCA2017[!duplicated(firesCA2017 %>% select(Longitude, Latitude)),]
```

Ahora se proyectan las coordenadas a *UTM* con un datum *WGS84*

```{r}
# Seleccionando las coordenadas
coordFiresCA2017 <- firesCA2017 %>% select(Longitude, Latitude) %>% as.matrix()

# Proyección de coordenadas a UTM
pointsFiresCA2017 <- project(coordFiresCA2017, "+proj=utm +zone=11N +ellps=WGS84") %>% 
  as.data.frame() %>% rename(X = Longitude, Y = Latitude)

pointsFiresCA2017 <- pointsFiresCA2017 %>% filter(!is.infinite(X))
```

\textbf{Poligono de Estados Unidos}

Se utiliza la función *map_data* para extraer la base de datos del contorno estados unidos, y posteriormente se filtra para estraer sólo la de California. 

```{r}
# Base de datos de Estados Unidos
UnitedStates <- map_data("state")
# ¿Qué estados?
table(UnitedStates$region)

# Filtramos para California
California <- UnitedStates %>% filter(region == "california")
```

Al hacer el filtro se dibuja el contorno para verificar si esta definido correctamente. 

```{r}
ggplot(California, aes(x=long, y=lat)) +
  geom_polygon(fill="white", colour="black") + coord_map("mercator")
```
Luego se proyectan el contorno a coordenadas *UTM* en la zona 11 y un datum *WGS84* y se anexan las localizaciones.

```{r}
# Coordenadas del borde para proyección
coordCA_border <- California %>% select(long, lat) %>% as.matrix()
coordCA_border <- project(coordCA_border, "+proj=utm +zone=11N +ellps=WGS84") %>% 
  as.data.frame() %>% rename(X = long, Y = lat)

ggplot(data = coordCA_border, aes(x = X, y = Y)) + 
  geom_polygon(fill = "white", color = "black") +
  geom_point(data = pointsFiresCA2017, aes(x = X, y = Y), color = "red") +
  ggtitle("Localización de Incendios en California, año 2017")
```

```{r}
# Creación del objeto owin a partir del borde
contpolyCA <- owin(poly = data.frame(x = rev(coordCA_border$X), y = rev(coordCA_border$Y)))
plot(contpolyCA)

# Creación del objeto ppp a partir del patrón de puntos
FiresCA2017_ppp <- ppp(x = pointsFiresCA2017$X, y = pointsFiresCA2017$Y, window = contpolyCA)
```

# Procesos puntuales

